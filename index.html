<!DOCTYPE html>
<html lang="fa" dir="rtl">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ابزار تولید ساکس ورودی هیدیفای</title>
  </head>
  <link rel="stylesheet" href="css/app.css">
  <body>
    <div class="container">
      <h1>تولید ساکس ورودی هیدیفای</h1>
      <div class="input-area">
        <textarea id="configInput" placeholder="کانفیگ جیسون که از هیدیفای کپی کرده اید را اینجا پیست کنید"></textarea>
      </div>
      <button onclick="processConfig()">تولید کانفیگ</button>
      <div class="result-area">
        <div class="result-box">
          <div class="result" id="resultBox"></div>
          <span class="copy-icon" onclick="copyToClipboard()">📋</span>
        </div>
      </div>
    </div>

    <!-- Footer Section -->
    <div class="footer">
      <div class="links">
        <a href="https://t.me/hiddifywarp" target="_blank">
          <img src="https://upload.wikimedia.org/wikipedia/commons/8/82/Telegram_logo.svg" alt="Telegram">
        </a>
        <a href="https://github.com/Jelingam/HiddifyTools" target="_blank">
          <img src="https://upload.wikimedia.org/wikipedia/commons/9/91/Octicons-mark-github.svg" alt="GitHub">
        </a>
      </div>
      <div class="footer-text">Jelingam, 2024</div>
    </div>

    <script>
      function isBase64(str) {
        try {
          return btoa(atob(str)) === str;
        } catch (err) {
          return false;
        }
      }

      function extractIpFromUrl(url) {
        const atIndex = url.indexOf('@');
        const colonIndex = url.indexOf(':', atIndex);
        if (atIndex !== -1 && colonIndex !== -1) {
          return url.substring(atIndex + 1, colonIndex);
        }
        return null;
      }

      function processConfig() {
        const input = document.getElementById('configInput').value.trim().split('\n');
        const resultBox = document.getElementById('resultBox');
        let extractedIPs = [];

        input.forEach(line => {
          line = line.trim();
          
          if (line.startsWith('vmess://')) {
            const base64Part = line.slice(8); // Remove 'vmess://'
            if (isBase64(base64Part)) {
              const decoded = atob(base64Part);
              try {
                const config = JSON.parse(decoded);
                if (config.add) {
                  extractedIPs.push(config.add);
                }
              } catch (e) {
                console.error('Invalid JSON in decoded config:', decoded);
              }
            }
          } else if (line.startsWith('vless://') || line.startsWith('trojan://')) {
            const ip = extractIpFromUrl(line);
            if (ip) {
              extractedIPs.push(ip);
            }
          }
        });

        resultBox.textContent = extractedIPs.length ? extractedIPs.join('\n') : 'No valid IPs found.';
      }

      function copyToClipboard() {
        const resultBox = document.getElementById('resultBox');
        const range = document.createRange();
        range.selectNode(resultBox);
        window.getSelection().removeAllRanges();
        window.getSelection().addRange(range);
        document.execCommand('copy');
        window.getSelection().removeAllRanges();
        alert('Copied to clipboard!');
      }
    </script>

  </body>
</html>
